<!DOCTYPE html>
<html lang="en">
<head>
    <title>Transporte Coletivo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div class="container"></div>
        <div id="mapid" style="height: 180px;"></div>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h1 class="text-center">Transporte Coletivo</h1>
                <form action="/check" method="post">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nome do Funcionário</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="cpf" class="form-label">CPF</label>
                        <input type="text" class="form-control" id="cpf" name="cpf" required>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" name="action" value="checkin">Check-in</button>
                        <button type="submit" class="btn btn-primary" name="action" value="checkout">Check-out</button>
                    </div>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Nome</th>
                            <th scope="col">CPF</th>
                            <th scope="col">Ação</th>
                            <th scope="col">Data</th>
                        </tr>
                    </thead>
                    <tbody id="checkTable">
                        <!-- As linhas da tabela serão preenchidas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Código para obter a localização atual do usuário e exibir o mapa
        navigator.geolocation.getCurrentPosition(function(location) {
            var latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);
            var mymap = L.map('mapid').setView(latlng, 13);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1
            }).addTo(mymap);
            L.marker(latlng).addTo(mymap);
        });

        // Código para preencher a tabela com os check-ins e check-outs do armazenamento local
        var checks = JSON.parse(localStorage.getItem('checks')) || [];
        var checkTable = document.getElementById('checkTable');
        checks.forEach(function(check) {
            var row = document.createElement('tr');
            ['name', 'cpf', 'action', 'date'].forEach(function(field) {
                var cell = document.createElement('td');
                cell.textContent = check[field];
                row.appendChild(cell);
            });
            checkTable.appendChild(row);
        });
    </script>
</body>
</html>
